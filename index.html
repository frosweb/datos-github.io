<!DOCTYPE html>

<html lang="es">

<head>

<meta charset="UTF-8">

<meta name="viewport" content="width=device-width, initial-scale=1.0">

<title>Sistema de Recolección de Datos Electorales</title>

<!-- Tailwind CSS -->

<script src="https://cdn.tailwindcss.com"></script>

<!-- Font Awesome para iconos -->

<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

<!-- Google Fonts: Inter -->

<link rel="preconnect" href="https://fonts.googleapis.com">

<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>

<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">

<style>

/* Estilo base del cuerpo del documento */

body {

font-family: 'Inter', sans-serif;

background-color: #f0f2f5;

}

/* Estilos para la barra de scroll */

::-webkit-scrollbar {

width: 8px;

}

::-webkit-scrollbar-track {

background: #f1f1f1;

}

::-webkit-scrollbar-thumb {

background: #888;

border-radius: 4px;

}

::-webkit-scrollbar-thumb:hover {

background: #555;

}

/* Clase para animación de entrada */

.fade-in {

animation: fadeIn 0.5s ease-in-out;

}

@keyframes fadeIn {

from { opacity: 0; transform: translateY(-10px); }

to { opacity: 1; transform: translateY(0); }

}

/* Estilo para el contenedor de la tabla para permitir scroll horizontal en móviles */

.table-container {

overflow-x: auto;

}

</style>

</head>

<body class="text-gray-800">

<script type="module">

// Import the functions you need from the SDKs you need

import { initializeApp } from "https://www.gstatic.com/firebasejs/11.9.1/firebase-app.js";

import { getAnalytics } from "https://www.gstatic.com/firebasejs/11.9.1/firebase-analytics.js";

// TODO: Add SDKs for Firebase products that you want to use

// https://firebase.google.com/docs/web/setup#available-libraries



// Your web app's Firebase configuration

// For Firebase JS SDK v7.20.0 and later, measurementId is optional

const firebaseConfig = {

apiKey: "AIzaSyBMF5tufwLvH8dcMOyaCZjCe4-9rvP1H44",

authDomain: "datacenter-a943d.firebaseapp.com",

projectId: "datacenter-a943d",

storageBucket: "datacenter-a943d.firebasestorage.app",

messagingSenderId: "191878024807",

appId: "1:191878024807:web:704bbb60bef6d1537acec2",

measurementId: "G-S77W50YWBT"

};



// Initialize Firebase

const app = initializeApp(firebaseConfig);

const analytics = getAnalytics(app);

</script>



<!-- Contenedor Principal -->

<div class="container mx-auto p-4 md:p-8">



<!-- Cabecera -->

<header class="mb-8 fade-in">

<h1 class="text-3xl md:text-4xl font-bold text-gray-900">Sistema de Gestión Electoral</h1>

<p class="text-gray-600 mt-2">Registra y analiza los datos de los electores en tiempo real.</p>

<div class="mt-4 text-xs text-gray-500">

<span class="font-bold">ID de Sesión:</span> <span id="userId">Autenticando...</span>

</div>

</header>



<!-- Dashboard de Estadísticas -->

<section id="dashboard" class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-8 fade-in">

<div class="bg-white p-6 rounded-xl shadow-md flex items-center space-x-4">

<div class="bg-blue-100 p-3 rounded-full">

<i class="fas fa-users fa-2x text-blue-500"></i>

</div>

<div>

<h2 class="text-gray-500 text-sm font-medium">Electores Registrados</h2>

<p id="total-electores" class="text-3xl font-bold">0</p>

</div>

</div>

<div class="bg-white p-6 rounded-xl shadow-md flex items-center space-x-4">

<div class="bg-green-100 p-3 rounded-full">

<i class="fas fa-check-to-slot fa-2x text-green-500"></i>

</div>

<div>

<h2 class="text-gray-500 text-sm font-medium">Votos Confirmados</h2>

<p id="total-votos" class="text-3xl font-bold">0</p>

</div>

</div>

<div class="bg-white p-6 rounded-xl shadow-md flex items-center space-x-4">

<div class="bg-yellow-100 p-3 rounded-full">

<i class="fas fa-chart-pie fa-2x text-yellow-500"></i>

</div>

<div>

<h2 class="text-gray-500 text-sm font-medium">Participación</h2>

<p id="porcentaje-participacion" class="text-3xl font-bold">0%</p>

</div>

</div>

</section>



<!-- Sección de Formulario y Lista -->

<div class="grid grid-cols-1 lg:grid-cols-3 gap-8">

<!-- Columna del Formulario -->

<aside class="lg:col-span-1 fade-in">

<div class="bg-white p-6 rounded-xl shadow-md">

<h2 class="text-2xl font-bold mb-6">Registrar Nuevo Elector</h2>

<form id="elector-form" class="space-y-4">

<div>

<label for="nombre" class="block text-sm font-medium text-gray-700">Nombre</label>

<input type="text" id="nombre" required class="mt-1 block w-full px-3 py-2 bg-white border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500">

</div>

<div>

<label for="apellido" class="block text-sm font-medium text-gray-700">Apellido</label>

<input type="text" id="apellido" required class="mt-1 block w-full px-3 py-2 bg-white border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500">

</div>

<div>

<label for="cedula" class="block text-sm font-medium text-gray-700">Cédula de Identidad</label>

<input type="text" id="cedula" required class="mt-1 block w-full px-3 py-2 bg-white border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500" placeholder="V-12345678">

</div>

<div>

<label for="telefono" class="block text-sm font-medium text-gray-700">Teléfono</label>

<input type="tel" id="telefono" class="mt-1 block w-full px-3 py-2 bg-white border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500">

</div>

<div>

<label for="centro-votacion" class="block text-sm font-medium text-gray-700">Centro de Votación</label>

<input type="text" id="centro-votacion" required class="mt-1 block w-full px-3 py-2 bg-white border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500">

</div>

<button type="submit" class="w-full bg-indigo-600 text-white font-bold py-3 px-4 rounded-lg hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500 transition-transform transform hover:scale-105">

<i class="fas fa-plus-circle mr-2"></i>Agregar Elector

</button>

</form>

</div>

</aside>



<!-- Columna de la Lista de Electores -->

<main class="lg:col-span-2 fade-in">

<div class="bg-white p-6 rounded-xl shadow-md">

<div class="flex flex-wrap justify-between items-center mb-4">

<h2 class="text-2xl font-bold">Lista de Electores</h2>

<div class="w-full sm:w-auto mt-2 sm:mt-0">

<input type="text" id="search-input" placeholder="Buscar por nombre, cédula..." class="w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500">

</div>

</div>

<div class="table-container">

<table class="min-w-full divide-y divide-gray-200">

<thead class="bg-gray-50">

<tr>

<th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Elector</th>

<th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Cédula</th>

<th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Centro de Votación</th>

<th scope="col" class="px-6 py-3 text-center text-xs font-medium text-gray-500 uppercase tracking-wider">¿Votó?</th>

<th scope="col" class="px-6 py-3 text-center text-xs font-medium text-gray-500 uppercase tracking-wider">Acciones</th>

</tr>

</thead>

<tbody id="electores-lista" class="bg-white divide-y divide-gray-200">

<!-- Las filas de los electores se insertarán aquí dinámicamente -->

<tr><td colspan="5" class="text-center p-8 text-gray-500">Cargando datos...</td></tr>

</tbody>

</table>

</div>

</div>

</main>

</div>

</div>



<!-- Modal de Confirmación para Eliminar -->

<div id="confirm-modal" class="fixed inset-0 bg-gray-600 bg-opacity-50 overflow-y-auto h-full w-full hidden z-50">

<div class="relative top-20 mx-auto p-5 border w-96 shadow-lg rounded-md bg-white">

<div class="mt-3 text-center">

<div class="mx-auto flex items-center justify-center h-12 w-12 rounded-full bg-red-100">

<i class="fas fa-trash-alt text-red-600 fa-lg"></i>

</div>

<h3 class="text-lg leading-6 font-medium text-gray-900 mt-2">Eliminar Elector</h3>

<div class="mt-2 px-7 py-3">

<p class="text-sm text-gray-500">

¿Estás seguro de que quieres eliminar a este elector? Esta acción no se puede deshacer.

</p>

</div>

<div class="items-center px-4 py-3">

<button id="confirm-delete-btn" class="px-4 py-2 bg-red-500 text-white text-base font-medium rounded-md w-auto shadow-sm hover:bg-red-700 focus:outline-none focus:ring-2 focus:ring-red-300">

Eliminar

</button>

<button id="cancel-delete-btn" class="px-4 py-2 bg-gray-200 text-gray-900 text-base font-medium rounded-md w-auto ml-2 shadow-sm hover:bg-gray-300 focus:outline-none focus:ring-2 focus:ring-gray-300">

Cancelar

</button>

</div>

</div>

</div>

</div>



<!-- Notificación Toast -->

<div id="toast-container" class="fixed bottom-5 right-5 z-50"></div>





<!-- Firebase SDK -->

<script type="module">

// Importar funciones necesarias de Firebase SDK

import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";

import { getAuth, signInAnonymously, signInWithCustomToken, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";

import { getFirestore, collection, addDoc, onSnapshot, doc, updateDoc, deleteDoc, query, where, getDocs, serverTimestamp, setLogLevel } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";



// --- CONFIGURACIÓN E INICIALIZACIÓN DE FIREBASE ---


setLogLevel('debug');



const firebaseConfig = JSON.parse(typeof __firebase_config !== 'undefined' ? __firebase_config : '{}');

const appId = typeof __app_id !== 'undefined' ? __app_id : 'default-app-id';



let app, db, auth, userId, votersCollectionRef;



// Inicializar Firebase

function initializeFirebase() {

try {

app = initializeApp(firebaseConfig);

db = getFirestore(app);

auth = getAuth(app);

setupAuthListener();

} catch (error) {

console.error("Error al inicializar Firebase:", error);

document.getElementById('electores-lista').innerHTML = '<tr><td colspan="5" class="text-center p-8 text-red-500">Error de conexión con la base de datos.</td></tr>';

}

}


// --- AUTENTICACIÓN ---


// Gestiona el listener de autenticación con fallback

function setupAuthListener() {

onAuthStateChanged(auth, async (user) => {

if (user) {

// Usuario ya autenticado, proceder

userId = user.uid;

} else {

// Si no hay usuario, intentar autenticar

try {

if (typeof __initial_auth_token !== 'undefined' && __initial_auth_token) {

await signInWithCustomToken(auth, __initial_auth_token);

} else {

await signInAnonymously(auth);

}

} catch (error) {

// El error 'auth/invalid-claims' es esperado si el token del entorno no es válido.

// Se maneja de forma silenciosa para pasar al modo anónimo.

if (error.code !== 'auth/invalid-claims') {

console.error("Fallo el signInWithCustomToken, intentando anónimo:", error);

}


// Si el token personalizado falla, recurrir a anónimo

try {

await signInAnonymously(auth);

} catch (anonError) {

console.error("Fallo el inicio anónimo de respaldo:", anonError);

}

}

// Actualizar userId si la autenticación fue exitosa

if(auth.currentUser) {

userId = auth.currentUser.uid;

}

}



// Si tenemos un userId, inicializamos la app

if (userId) {

document.getElementById('userId').textContent = userId;

votersCollectionRef = collection(db, `artifacts/${appId}/public/data/voters`);

listenForVoters();

} else {

console.error("La autenticación falló. La aplicación no puede continuar.");

document.getElementById('userId').textContent = 'Error de autenticación';

}

});

}





// --- UI y NOTIFICACIONES ---



// Muestra una notificación toast

function showToast(message, isError = false) {

const container = document.getElementById('toast-container');

const toast = document.createElement('div');

const bgColor = isError ? 'bg-red-600' : 'bg-green-600';

toast.className = `transform transition-all duration-300 ease-in-out mb-2 py-2 px-4 rounded-lg shadow-lg text-white ${bgColor}`;

toast.style.opacity = '0';

toast.style.transform = 'translateY(20px)';


toast.innerHTML = `<p>${message}</p>`;

container.appendChild(toast);


// Animación de entrada

setTimeout(() => {

toast.style.opacity = '1';

toast.style.transform = 'translateY(0)';

}, 10);


// Desvanecimiento y eliminación

setTimeout(() => {

toast.style.opacity = '0';

toast.style.transform = 'translateY(20px)';

setTimeout(() => toast.remove(), 300);

}, 4000);

}



// --- MANEJO DE DATOS (FIRESTORE) ---



const form = document.getElementById('elector-form');

const searchInput = document.getElementById('search-input');

let allVoters = [];



form.addEventListener('submit', async (e) => {

e.preventDefault();


const cedula = form.cedula.value.trim();

if (!cedula) {

showToast("La cédula es obligatoria.", true);

return;

}



const q = query(votersCollectionRef, where("cedula", "==", cedula));

const querySnapshot = await getDocs(q);



if (!querySnapshot.empty) {

showToast("Error: Ya existe un elector con esta cédula.", true);

return;

}



try {

await addDoc(votersCollectionRef, {

nombre: form.nombre.value,

apellido: form.apellido.value,

cedula: cedula,

telefono: form.telefono.value,

centroVotacion: form['centro-votacion'].value,

hasVoted: false,

createdAt: serverTimestamp()

});

form.reset();

showToast("Elector agregado correctamente.");

} catch (error) {

console.error("Error al agregar elector: ", error);

showToast("No se pudo agregar el elector.", true);

}

});



function listenForVoters() {

if (!votersCollectionRef) return;

onSnapshot(votersCollectionRef, (snapshot) => {

allVoters = [];

snapshot.forEach(doc => {

allVoters.push({ id: doc.id, ...doc.data() });

});

allVoters.sort((a, b) => (b.createdAt?.toMillis() || 0) - (a.createdAt?.toMillis() || 0));


renderVoters(allVoters);

updateDashboard(allVoters);

}, (error) => {

console.error("Error al obtener datos en tiempo real:", error);

document.getElementById('electores-lista').innerHTML = '<tr><td colspan="5" class="text-center p-8 text-red-500">Error al cargar los datos. Verifique la conexión.</td></tr>';

});

}



searchInput.addEventListener('input', (e) => {

const searchTerm = e.target.value.toLowerCase();

const filteredVoters = allVoters.filter(voter =>

voter.nombre.toLowerCase().includes(searchTerm) ||

voter.apellido.toLowerCase().includes(searchTerm) ||

voter.cedula.toLowerCase().includes(searchTerm) ||

voter.centroVotacion.toLowerCase().includes(searchTerm)

);

renderVoters(filteredVoters);

});



function renderVoters(voters) {

const lista = document.getElementById('electores-lista');

if (voters.length === 0 && searchInput.value.length === 0) {

lista.innerHTML = '<tr><td colspan="5" class="text-center p-8 text-gray-500">Aún no hay electores registrados.</td></tr>';

return;

}

if (voters.length === 0 && searchInput.value.length > 0) {

lista.innerHTML = '<tr><td colspan="5" class="text-center p-8 text-gray-500">No se encontraron electores.</td></tr>';

return;

}



lista.innerHTML = voters.map(voter => `

<tr id="voter-${voter.id}" class="transition-colors duration-300 ${voter.hasVoted ? 'bg-green-50' : ''}">

<td class="px-6 py-4 whitespace-nowrap">

<div class="text-sm font-medium text-gray-900">${voter.nombre} ${voter.apellido}</div>

<div class="text-sm text-gray-500">${voter.telefono || 'N/A'}</div>

</td>

<td class="px-6 py-4 whitespace-nowrap text-sm text-gray-700">${voter.cedula}</td>

<td class="px-6 py-4 whitespace-nowrap text-sm text-gray-700">${voter.centroVotacion}</td>

<td class="px-6 py-4 whitespace-nowrap text-center">

<button data-id="${voter.id}" data-voted="${voter.hasVoted}" class="toggle-vote-btn inline-flex items-center px-3 py-1.5 border border-transparent text-xs leading-4 font-medium rounded-full shadow-sm text-white transition-colors duration-200 ${voter.hasVoted ? 'bg-green-600 hover:bg-green-700' : 'bg-gray-400 hover:bg-gray-500'} focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500">

${voter.hasVoted ? '<i class="fas fa-check-circle mr-1"></i> Sí' : '<i class="fas fa-times-circle mr-1"></i> No'}

</button>

</td>

<td class="px-6 py-4 whitespace-nowrap text-center text-sm font-medium">

<button data-id="${voter.id}" class="delete-btn text-gray-400 hover:text-red-600 transition-colors duration-200">

<i class="fas fa-trash-alt fa-lg"></i>

</button>

</td>

</tr>

`).join('');

}



function updateDashboard(voters) {

const totalElectores = voters.length;

const totalVotos = voters.filter(v => v.hasVoted).length;

const porcentaje = totalElectores > 0 ? ((totalVotos / totalElectores) * 100).toFixed(1) : 0;



document.getElementById('total-electores').textContent = totalElectores;

document.getElementById('total-votos').textContent = totalVotos;

document.getElementById('porcentaje-participacion').textContent = `${porcentaje}%`;

}





// --- MANEJO DE EVENTOS DE ACCIONES ---



const electoresLista = document.getElementById('electores-lista');

const confirmModal = document.getElementById('confirm-modal');

const confirmDeleteBtn = document.getElementById('confirm-delete-btn');

const cancelDeleteBtn = document.getElementById('cancel-delete-btn');

let voterIdToDelete = null;



electoresLista.addEventListener('click', async (e) => {

const target = e.target.closest('button');

if (!target) return;



const id = target.dataset.id;


if (target.classList.contains('toggle-vote-btn')) {

const hasVoted = target.dataset.voted === 'true';

const voterRef = doc(votersCollectionRef, id);

try {

await updateDoc(voterRef, { hasVoted: !hasVoted });

} catch (error) {

console.error("Error al actualizar el estado de voto:", error);

showToast("Error al cambiar el estado del voto.", true);

}

}



if (target.classList.contains('delete-btn')) {

voterIdToDelete = id;

confirmModal.classList.remove('hidden');

}

});



cancelDeleteBtn.addEventListener('click', () => {

voterIdToDelete = null;

confirmModal.classList.add('hidden');

});



confirmDeleteBtn.addEventListener('click', async () => {

if (voterIdToDelete) {

try {

await deleteDoc(doc(votersCollectionRef, voterIdToDelete));

showToast("Elector eliminado.");

} catch (error) {

console.error("Error al eliminar elector:", error);

showToast("Error al eliminar elector.", true);

} finally {

voterIdToDelete = null;

confirmModal.classList.add('hidden');

}

}

});



// --- INICIO DE LA APLICACIÓN ---


document.addEventListener('DOMContentLoaded', initializeFirebase);



</script>

</body>

</html> 
